/*! Node-Chat 10-11-2014 */
function updateContainer(){$(window).height();$(".chatLog").animate({height:$(window).height()-125},1e3,function(){$("#history").scrollTop($("#history")[0].scrollHeight)})}function checkInput(){var a=document.getElementById("chatBox").value;"/nick"==a.substr(0,5)&&(document.getElementById("chatBox").value=a.substr(0,40))}function saveNick(){document.getElementById("chatBox").value="/nick "+document.getElementById("newNick").value,sendMessage(),$("#changeNick").foundation("reveal","close")}function chat(a,b,c){var d,e=moment().format("HH:mm:ss");void 0===c&&a==lastUser&&15>lastUserMsgCount?(lastUserMsgCount++,d=""):(d=a,lastUserMsgCount=1),""!==d&&"SERVER"!=d&&d!=$(nickname).html()&&(d='<span class="chatUser">'+d+"</span>"),lastUser=a,"SERVER"==d&&(d='<span class="serverMessage">'+d+"</span>"),a==$(nickname).html()&&(b="<span class='selfMessage'>"+b+"</span>"),$("#history").append('     <div class="row">       <div class="large-1 columns show-for-large-up right-seperator" style="padding:0">         <div class="chatTime full-height">'+e+'&nbsp;&nbsp;</div>       </div>       <div class="small-4 medium-2 large-2 columns right-seperator">          <div class="chatName full-height">'+d+'</div>       </div>       <div class="small-8 medium-10 large-9 columns">         <div class="chatMessage full-height">'+b+"</div>       </div>     </div>     "),linkUsers(),truncateHistory(),"SERVER"!=a&&notify(a+": "+b.replace(/(<([^>]+)>)/gi,""),!1);var f=$(".chatMessage").last().height();$(".chatName").last().css({height:f}),$(".chatTime").last().css({height:f}),$("#history").scrollTop($("#history")[0].scrollHeight),isActive||"SERVER"==a||(playSound(alert),document.title="New Message!",b.toLowerCase().indexOf($(nickname).html().toLowerCase())>-1&&(setTimeout(function(){playSound(alert)},6),document.title="You have been mentioned!",notify("You have been mentioned by "+a+"!",!1)))}function truncateHistory(){var a=200,b=$("#history").children(".row");b.length<=a||b.slice(0,$("#history").children().length-a-1).remove()}function clearLog(){$("#history").children(".row").remove(),lastUser="",lastUserMsgCount=0}function updateUsers(a){var b="";b+="<li><label>Online Users</label></li>";for(var c in a)b+='<li><a href="#" ',a[c][0]!=$(nickname).html()&&(b+='class="chatUser"'),b+=">"+a[c][0]+'</a><div class="dot"></div></li>';document.getElementById("usersList").innerHTML=b,b="",b+="<li><label>Online Users</label></li>";for(var d in a)b+='<li><a href="#" ',a[d][0]!=$(nickname).html()&&(b+='class="chatUser"'),b+=">"+a[d][0]+'</a><div class="dot',b+=a[d][2]?" dot-active":" dot-away",b+='"></div></li>';document.getElementById("inlineUsersList").innerHTML=b,linkUsers()}function linkUsers(){$(".chatUser").click(function(){document.getElementById("chatBox").value="/pm "+$(this).html()+" ",document.getElementById("chatBox").focus()})}function sendMessage(){if(socket.socket.connected||"/connect"!=document.getElementById("chatBox").value.trim()||socket.socket.connect(),""!==document.getElementById("chatBox").value.trim()){for(;$("#chatBox").hasClass("error");)$("#chatBox").removeClass("error");if("/clear"==document.getElementById("chatBox").value.trim())clearLog();else{var a=document.getElementById("chatBox").value;if("/register"==a.substr(0,9)){var b=a.split(" ");b[1]=CryptoJS.SHA1(b[1]),$.cookie("pass",b[1],{expires:365}),$.cookie("nick",$(nickname).html(),{expires:365}),b=b.join(" "),document.getElementById("chatBox").value=b}if("/nick"==a.substr(0,5)){var c=a.split(" ");c.length>2&&(c[2]=CryptoJS.SHA1(c[2]),$.cookie("pass",c[2],{expires:365}),c=c.join(" "),document.getElementById("chatBox").value=c)}socket.emit("broadcast",{message:""+document.getElementById("chatBox").value})}return void(document.getElementById("chatBox").value="")}$("#chatBox").hasClass("error")||($("#chatBox").addClass("error"),setTimeout(function(){$("#chatBox").removeClass("error")},5e3))}function updateStatus(){socket.emit("status",{status:isActive})}function updateName(a){$(nickname).html(a.name),$(".tab-bar-section").children(".title").html($(".currentChannel").html()+'<div class="show-for-large-up" style="display:inline-block !important;">&nbsp;- '+$(nickname).html()+"</div>")}function reverseEscapeHtml(a){return String(a).replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;/g,function(a){return reverseEntityMap[a]})}function notify(a,b){!b&&isActive||Notify.needsPermission()||new Notify("HardOrange Chat",{body:reverseEscapeHtml(a),icon:"images/hardorange_small.png",timeout:10}).show()}function needPermission(){$("#enableNotifications").html("Enable Desktop Notifications"),$("#enableNotifications").click(function(){Notify.requestPermission(),noNeedPermission()})}function noNeedPermission(){$("#enableNotifications").html("Desktop Notifications Enabled"),$("#enableNotifications").click(function(){notify("Notifications can be disabled in your browser's settings.",!0)})}function playSound(a){sounds&&a.play()}function toggleSounds(){sounds?(sounds=!1,$.removeCookie("sounds"),$("#toggleSounds").html("Enable Message Sounds")):(sounds=!0,$.cookie("sounds",!0,{expires:365}),$("#toggleSounds").html("Disable Message Sounds"))}$(document).foundation();var users=[],socket=io.connect("//"+document.domain),isActive=!0,modalOpen=!1,sounds=!1,lastUser="",lastUserMsgCount=0,alert=new Audio("sounds/alert.mp3");$(document).ready(function(){updateContainer(),$(window).resize(function(){updateContainer()})}),$("#chatLog").click(function(){$("#chatBox").focus()}),window.onfocus=function(){isActive=!0,updateStatus(),document.title="HardOrange Chat"},window.onblur=function(){isActive=!1,updateStatus()},$(document).on("opened","[data-reveal]",function(){document.getElementById("newNick").focus(),modalOpen=!0}),$(document).on("closed","[data-reveal]",function(){modalOpen=!1}),$("#saveNick").click(function(){$.cookie("nick",$(nickname).html(),{expires:365}),notify("Nick saved!",!0)}),socket.on("connect",function(){$("#chatBox").removeClass("error"),void 0!==$.cookie("nick")&&void 0!==$.cookie("pass")?socket.emit("config",{name:$.cookie("nick"),password:$.cookie("pass")}):void 0!==$.cookie("nick")?socket.emit("config",{name:$.cookie("nick")}):socket.emit("config",{name:""}),$(document).keydown(function(a){13==a.which&&(modalOpen?saveNick():sendMessage())})}),socket.on("broadcast",function(a){chat(a.client,a.message)}),socket.on("pm",function(a){chat(a.client,a.message,!0)}),socket.on("annouce",function(a){chat("SERVER",a.message)}),socket.on("users",function(a){updateUsers(a)}),socket.on("channel",function(a){$(".currentChannel").html(a.channel),$(".tab-bar-section").children(".title").html($(".currentChannel").html()+'<div class="show-for-large-up" style="display:inline-block !important;">&nbsp;- '+$(nickname).html()+"</div>")}),socket.on("name",function(a){updateName(a)}),socket.on("disconnect",function(){chat("SERVER",'<span class="serverMessage">You have disconnected. Type /connect to reconnect.</span>'),$("#chatBox").removeClass("error"),updateUsers([])});var reverseEntityMap={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"};Notify.isSupported()?Notify.needsPermission()?needPermission():noNeedPermission():$("#enableNotifications").html("No Browser Notification Support"),$("#toggleSounds").click(function(){toggleSounds()}),void 0!==$.cookie("sounds")&&toggleSounds();var swipeleft=Hammer(document.body).on("swiperight",function(){$(".off-canvas-wrap").addClass("move-right")}),swiperight=Hammer(document.body).on("swipeleft",function(){$(".off-canvas-wrap").addClass("move-left")});